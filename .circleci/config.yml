jobs:
  build:
    working_directory: ~/CircleCIApplitoolsCypress
    docker:
    - image: cypress/base:10
    steps:
    - checkout
    - restore_cache:
        keys:
        - v2-deps-{{ .Branch }}-{{ checksum "package-lock.json" }}
        - v2-deps-{{ .Branch }}-
        - v2-deps-
    - save_cache:
        key: v2-deps-{{ .Branch }}-{{ checksum "package-lock.json" }}
        paths:
        - ~/.npm
        - ~/.cache
    - run: npm ci
    - run:
        command: |
          export APPLITOOLS_BATCH_ID=${CIRCLE_SHA1}
          echo $APPLITOOLS_BATCH_ID
          npm run cy:run -- --spec "cypress/integration/examples/actions.spec.js"
    # - run:
    #     name: Run Cypress/Applitools tests
    #     command: npm run cy:run -- --spec "cypress/integration/examples/actions.spec.js"

    - run: {}
      command: |
        export APPLITOOLS_BATCH_ID=`echo $CIRCLE_SHA1`
        echo $APPLITOOLS_BATCH_ID
        npm run cy:run -- --spec "cypress/integration/examples/actions.spec.js"
workflows:
  version: 2
  workflow:
    jobs:
    - build
